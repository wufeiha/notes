### 案例一

redis standstone模式 内存激增至超过85%，数据写入读取经常出错，后来发现是aof rewrite一直不成功，rewrite需要预留内存空间，最后通过联系服务商扩容解决。

### 案例二

数据突然自8%增至80%，导致多个程序偶尔出现写入失败的情况，排查如下。

1. redis-cli大key扫描，发现多个超过100MB string类型的大key，不过应该不是这个原因导致的。【每次只能扫描一个db】

   ```shell
   redis-cli -h 192.168.200.11 -p 6379 -n dbIndex --bigkeys
   ```

2. 由于没有redis server 文件系统权限，通过redis-cli dump rdb文件。【一定要在服务器操作，走内网】

   ```shell
   redis-cli -h 192.168.200.11 -p 6379 --rdb localPath
   ```

3. 安装并使用rdb工具分析rdb文件，生成内存占用top10。两种方式，看个人需求。

   1. 直接生成top10 csv

      ```shell
      rdb -c memory aa.rdb --bytes 1024 --largest 10  > memory_report.csv
      ```

   2. 生成全部csv再使用sort排序

      ```shell
      rdb --command memory aa.rdb > memory_report.csv
      sort -t',' -k4 -nr memory_report.csv | head -n 10
      ```

​	**rdb安装**

```shel
pip install rdbtools python-lzf
```

