**采用异步延时双删保证数据最终一致性**

> （1）先淘汰缓存
>
> （2）再写数据库
>
> （3）休眠1秒，再次淘汰缓存（异步）

**缓存删除失败重试机制**

**方案一：**

﻿

![img](https://i.loli.net/2021/03/24/tjXLOBgleUQdhaS.png)

﻿

> 流程如下所示
>
> （1）更新数据库数据；
>
> （2）缓存因为种种问题删除失败
>
> （3）将需要删除的key发送至消息队列
>
> （4）自己消费消息，获得需要删除的key
>
> （5）继续重试删除操作，直到成功
>
> 然而，该方案有一个缺点，对业务线代码造成大量的侵入。于是有了方案二，在方案二中，启动一个订阅程序去订阅数据库的binlog，获得需要操作的数据。在应用程序中，另起一段程序，获得这个订阅程序传来的信息，进行删除缓存操作。

﻿

方案二：

﻿

![img](https://i.loli.net/2021/03/24/i94zevJt1AukhVa.png)

﻿

> 流程如下图所示：
>
> （1）更新数据库数据
>
> （2）数据库会将操作信息写入binlog日志当中
>
> （3）订阅程序提取出所需要的数据以及key
>
> （4）另起一段非业务代码，获得该信息
>
> （5）尝试删除缓存操作，发现删除失败
>
> （6）将这些信息发送至消息队列
>
> （7）重新从消息队列中获得该数据，重试操作。

﻿

**读取binlog的中间件，可以采用阿里开源的canal**

﻿